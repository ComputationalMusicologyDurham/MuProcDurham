

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shepard Tones &mdash; muprocdurham  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/autoclasstoc.css?v=08871587" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tonnetz Generation" href="Practical_Tonnetz_Generation.html" />
    <link rel="prev" title="Practical: Hierarchical Models" href="Practical_Hierarchical_Models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            muprocdurham
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MuProcDurham Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Lecture_From_Overtones_to_Tuning_Systems_and_Harmonies.html">Spectrograms &amp; Overtones</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Sequential_Models.html">Practical: Sequential Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Hierarchical_Models.html">Practical: Hierarchical Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Shepard Tones</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hints">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-many-perfectly-symmetric-chords-are-there-in-12-tone-equal-temperament">How many perfectly symmetric chords are there in 12-tone equal temperament?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-does-the-space-that-musical-tones-live-in-look-like">How does the space that musical tones live in look like?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-geometric-shape-is-the-product-of-two-circles">What geometric shape is the product of two circles?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Tonnetz_Generation.html">Tonnetz Generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">muprocdurham</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">MuProcDurham Gallery</a></li>
      <li class="breadcrumb-item active">Shepard Tones</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-practical-shepard-tones-and-pitch-class-embeddings-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="shepard-tones">
<span id="sphx-glr-auto-examples-practical-shepard-tones-and-pitch-class-embeddings-py"></span><h1>Shepard Tones<a class="headerlink" href="#shepard-tones" title="Link to this heading"></a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In[ ]:</span>


<span class="c1"># !pip install muprocdurham  # latest release</span>
<span class="c1"># !pip install git+https://github.com/MusicComputingDurham/MuProcDurham.git@main  # latest main version (typically same as release)</span>
<span class="c1"># !pip install git+https://github.com/MusicComputingDurham/MuProcDurham.git@dev  # latest dev version</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">muprocdurham</span><span class="w"> </span><span class="kn">import</span> <span class="n">sound</span> <span class="k">as</span> <span class="n">s</span>
<span class="c1"># !pip install umap-learn plotly  # if not alreay installed</span>


<span class="c1"># # Shepard Tones</span>

<span class="c1"># The first part of this practical is about creating so-called *Shepard tones*, after Roger Shepard (also see https://en.wikipedia.org/wiki/Shepard_tone)</span>
<span class="c1">#</span>
<span class="c1"># - Shepard RN (1964) Circularity in judgments of relative pitch. The journal of the acoustical society of America 36:2346–2353</span>
<span class="c1">#</span>
<span class="c1"># A Shepard tone is an overlay of multiple sine waves separated by an octave. The amplitude is maximal for medium frequencies and smoothly goes to zero for very high and very low frequencies. As a consequence, the fundamental frequency of a Shepard tone is ambiguous, as there is not a single well-defined audible lowest frequency. In contrast, the pitch class *is* well-defined. This properties allows for a number of interesting auditory effects and illusions.</span>

<span class="c1"># ## Creating Sounds</span>

<span class="c1"># First, we have to be able to create sound. There are some helper functions for this in `muprocdurham.sound` (imported as `s` above), in particular `sound`, `audio`, and `spectrogram`.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>  <span class="c1"># duration of 1 second is the default</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="c1"># In fact, this is just a very simplified example. The `sound` function really maintains a bank of oscillators for which you specify the frequency and amplitude over time. In general, you should provide a callback function that takes a NumPy array `time` (in seconds) of shape `(n,)` as input and return a pair of arrays of shape `(n, k)` with frequencies and amplitudes for each point in time (`k` is the number of oscillators used).</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_001.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_001.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">freqs_amps</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">440</span><span class="p">,</span> <span class="mi">880</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span>  <span class="c1"># first oscillator continuously increases in frequency from 440 to 880Hz</span>
             <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">660</span><span class="p">]</span>          <span class="c1"># second oscillator stays at 660Hz</span>
    <span class="n">amps</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span>     <span class="c1"># first oscillator increases in amplitude</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">]</span>           <span class="c1"># second oscillator stays at lower amplitude</span>
    <span class="c1"># you can use np.stack to combine these</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">amps</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">freqs_amps</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="c1"># For convenience, some simpler cases are supported as well, where you might not want to fully specify both arrays.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_002.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_002.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="c1"># a single constant frequency can be specified as an integer</span>
    <span class="mi">440</span><span class="p">,</span>
    <span class="c1"># multiple constant frequencies can be specified as a list or 1D array</span>
    <span class="p">[</span><span class="mi">440</span><span class="p">,</span> <span class="mi">660</span><span class="p">],</span>
    <span class="c1"># if only the frequencies change, not the amplitudes, you can return a single array (make sure this is not 1D but (n, 1) for a single frequency)</span>
    <span class="k">lambda</span> <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">440</span><span class="p">,</span> <span class="mi">880</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">880</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
    <span class="c1"># the full case from above, just written as a single lambda function</span>
    <span class="k">lambda</span> <span class="n">time</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">440</span><span class="p">,</span> <span class="mi">880</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">660</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                           <span class="p">),</span>
<span class="p">]:</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="c1"># ## Creating Shepard Tones</span>

<span class="c1"># A Shepard tone can be specified by giving a &quot;fundamental&quot; frequency `f`, where fundamentals that differ by one or more octaves result in the same Shepard tone. The first step for creating a Shepard tone therefore is to define a function that takes a frequency `f` and returns an array of all octave-related frequencies in the audible range from 20 to 20,000Hz. A slighly more elaborate version of the function should take two additional parameters, `n` and `m`, indicating how many octaves below and above the audible range, respectively, should be additionally included (this will become relevant later).</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_003.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_003.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_004.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_004.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_005.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_005.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_006.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_006.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shepard_freqs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="mi">20000</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="c1"># set min/max frequency</span>
    <span class="n">min_freq</span> <span class="o">=</span> <span class="n">min_freq</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="n">n</span>
    <span class="n">max_freq</span> <span class="o">=</span> <span class="n">max_freq</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="n">m</span>
    <span class="c1"># start at min frequency</span>
    <span class="k">while</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="n">min_freq</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="n">min_freq</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="c1"># collect all octaves in range</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="n">max_freq</span><span class="p">:</span>
        <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="c1"># return frequencies as 1D array</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">shepard_freqs</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>       <span class="c1"># [   25.    50.   100.   200.   400.   800.  1600.  3200.  6400. 12800.]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shepard_freqs</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># [1.25e+01 2.50e+01 5.00e+01 1.00e+02 2.00e+02 4.00e+02 8.00e+02 1.60e+03 3.20e+03 6.40e+03 1.28e+04]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shepard_freqs</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  <span class="c1">#          [2.50e+01 5.00e+01 1.00e+02 2.00e+02 4.00e+02 8.00e+02 1.60e+03 3.20e+03 6.40e+03 1.28e+04 2.56e+04]</span>


<span class="c1"># Next, we need to assign amplitudes to each frequency following a bell-shaped (e.g. Gaussian) envelope in pitch space (log-frequency space). The function should take an array of frequencies and return an array of amplituded. To adapt the shape, it should take a `max_f` and `decay` parameter specifying the frequency with maximum amplitude and how fast the amplitude decays for lower/higher frequencies.</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[   25.    50.   100.   200.   400.   800.  1600.  3200.  6400. 12800.]
[1.25e+01 2.50e+01 5.00e+01 1.00e+02 2.00e+02 4.00e+02 8.00e+02 1.60e+03
 3.20e+03 6.40e+03 1.28e+04]
[2.50e+01 5.00e+01 1.00e+02 2.00e+02 4.00e+02 8.00e+02 1.60e+03 3.20e+03
 6.40e+03 1.28e+04 2.56e+04]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shepard_amps</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">max_f</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">max_f</span><span class="p">)</span>  <span class="c1"># difference in log-frequency space</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decay</span><span class="p">)</span>          <span class="c1"># decay/rescale in log-frequency space</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>               <span class="c1"># Gaussian bell</span>

<span class="c1"># you can check the shape in frequency and log-frequency space</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">shepard_amps</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">shepard_amps</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>


<span class="c1"># We can now use this to generate a Shepard tone by specifying the frequencies and amplitudes.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_007.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_007.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shepard</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">shepard_freqs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">amps</span> <span class="o">=</span> <span class="n">shepard_amps</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">sound</span><span class="p">((</span><span class="n">freqs</span><span class="p">,</span> <span class="n">amps</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">shepard</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>


<span class="c1"># ## Effects and Illusions</span>

<span class="c1"># ### Shepard Swipe</span>

<span class="c1"># Because of being octave-invariant, a Shepard tone that continuously rises will be identical after one octave. Hence, it creates the illusion of an endlessly rising tone. Create a `shepard_swipe` function that starts at a specific frequency `f` and rises with a certain `speed`, repeating the full octave cycle `repeats` times.</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_008.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_008.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<section id="hints">
<h2>Hints:<a class="headerlink" href="#hints" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>the frequency factor must change exponentially for pitch to change linearly</p></li>
<li><p>example: if <cite>speed=2</cite> and time is 1.5, the tone should have completed 3 cycles</p></li>
<li><p>after <cite>n</cite> cycles, the frequency factor should be <cite>2**n</cite></p></li>
<li><p>you might want to add some extra octaves above/below so the full audible range is filled even after rising/falling</p></li>
<li><p>if you have two 1D arrays <cite>a</cite> and <cite>b</cite> with shapes <cite>(n,)</cite> and <cite>(k,)</cite>, respectively, then <cite>a[:, None] * b[None, :]</cite> gives you an array of shape <cite>(n, k)</cite> via broadcasting</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shepard_swipe</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">freq_amp</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">shepard_freqs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">repeats</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">repeats</span><span class="p">)</span>  <span class="c1"># add extra octaves</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="n">speed</span><span class="p">)</span>                     <span class="c1"># compute factor for each point in time</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">factor</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>         <span class="c1"># use broadcasting to generate full frequency array</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">shepard_amps</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">amp</span>

    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="n">freq_amp</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">repeats</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">))</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">shepard_swipe</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>


<span class="c1"># ### Shepard Swipes of Symmetric Chords</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_009.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_009.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
</section>
<section id="how-many-perfectly-symmetric-chords-are-there-in-12-tone-equal-temperament">
<h2>How many perfectly symmetric chords are there in 12-tone equal temperament?<a class="headerlink" href="#how-many-perfectly-symmetric-chords-are-there-in-12-tone-equal-temperament" title="Link to this heading"></a></h2>
<p>For each of these chords, generate an overlay of rising/falling Shepard tones. <strong>What do you notice concering their repeat times?</strong></p>
<p>%%
Hints:
——</p>
<ul class="simple">
<li><p>if you <cite>from pitchtypes import Enharmonic</cite>, you get the frequency of, say, a C4 with <cite>Enharmonic.Pitch(“C4”).freq()</cite> or <cite>Enharmonic.Pitch(60).freq()</cite></p></li>
<li><p>to overlay sounds generated with the <cite>sound</cite> function, you can simply add them (they are just NumPy arrays with waveforms)</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pitchtypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enharmonic</span>

<span class="n">waves</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">shepard_swipe</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="s2">&quot;4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">freq</span><span class="p">(),</span> <span class="n">speed</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;C#&quot;</span><span class="p">,</span> <span class="s2">&quot;Eb&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;F#&quot;</span><span class="p">]}</span>

<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;Eb&quot;</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;C#&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;Eb&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">waves</span><span class="p">[</span><span class="s2">&quot;F#&quot;</span><span class="p">])</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># # Pitch-Class Embeddings</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
</section>
<section id="how-does-the-space-that-musical-tones-live-in-look-like">
<h2>How does the space that musical tones live in look like?<a class="headerlink" href="#how-does-the-space-that-musical-tones-live-in-look-like" title="Link to this heading"></a></h2>
<p>Many models of tonal space consider pitch classes, that is, they ignore the octave. There are music theoretic consideration to come up with such spaces, but in this practical, we will take a sound-based approach. Shepard tones are a great starting point because they are octave-invariant, so essentially the audible equivalent of a pitch class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Harmonic Shepard Tones</span>

<span class="c1"># First, to make the sounds more similar to natural instruments, create a *harmonic Shepard tone*, that is an overlay of Shepard tones corresponding to harmonic overtones with exponentially decreasing amplitude.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">harmonic_shepard</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">waves</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="n">decay</span><span class="p">)</span> <span class="o">*</span> <span class="n">shepard</span><span class="p">(</span><span class="n">f0</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">waves</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">harmonic_shepard</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>


<span class="c1"># Here is a function to compute the spectrum of a wave via Fourier transform. This can be used to compute spectral similarity. You can check the difference between a normal Shepard tone and the harmonic version below.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_010.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_010.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
    <span class="c1"># normalise and fade in/out</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">fade</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mf">0.05</span><span class="p">))</span>
    <span class="c1"># compute spectrum and ignore phases</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>
    <span class="c1"># do some smoothing</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">/=</span> <span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">fft</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fft</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">spectrum</span><span class="p">(</span><span class="n">shepard</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">spectrum</span><span class="p">(</span><span class="n">harmonic_shepard</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>


<span class="c1"># ## Pitch-Class Embeddings</span>

<span class="c1"># Create an array of 12 `points`, corresponding to the spectra of harmonic Shepard tones of the 12 pitch classes in 12-tone equal temperament. Also store string labels in a `pitch_classes` array.</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_011.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_011.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x7f95cc65ace0&gt;]
</pre></div>
</div>
</section>
<section id="id1">
<h2>Hints:<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>order pitch classes along the line of fifths</p></li>
<li><p>the <cite>points</cite> array should have shape <cite>(12, n)</cite>, where <cite>n</cite> is a larger number corresponding to the resolution of the spectrum</p></li>
<li><p>use <cite>duration=0.1</cite> for sound generation to reduce the number of dimensions</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">pitch_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;F#&quot;</span><span class="p">,</span> <span class="s2">&quot;C#&quot;</span><span class="p">,</span> <span class="s2">&quot;G#&quot;</span><span class="p">,</span> <span class="s2">&quot;D#&quot;</span><span class="p">,</span> <span class="s2">&quot;A#&quot;</span><span class="p">])</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">spectrum</span><span class="p">(</span><span class="n">harmonic_shepard</span><span class="p">(</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="s2">&quot;4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">freq</span><span class="p">(),</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pitch_classes</span><span class="p">])</span>
<span class="n">points</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># Embed these points into 2, 3, and 4 dimensions using UMAP and store the embeddings in a dictionary with the dimension as key.</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(12, 2191)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">umap</span>

<span class="n">embeddings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
    <span class="n">embeddings</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
                                <span class="n">n_neighbors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">n_epochs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="c1">#                                 verbose=True,</span>
                               <span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>


<span class="c1"># ### 2D Embedding</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.10.16/x64/lib/python3.10/site-packages/sklearn/utils/deprecation.py:151: FutureWarning: &#39;force_all_finite&#39; was renamed to &#39;ensure_all_finite&#39; in 1.6 and will be removed in 1.8.
  warnings.warn(
/opt/hostedtoolcache/Python/3.10.16/x64/lib/python3.10/site-packages/sklearn/utils/deprecation.py:151: FutureWarning: &#39;force_all_finite&#39; was renamed to &#39;ensure_all_finite&#39; in 1.6 and will be removed in 1.8.
  warnings.warn(
/opt/hostedtoolcache/Python/3.10.16/x64/lib/python3.10/site-packages/sklearn/utils/deprecation.py:151: FutureWarning: &#39;force_all_finite&#39; was renamed to &#39;ensure_all_finite&#39; in 1.6 and will be removed in 1.8.
  warnings.warn(
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">cycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pitch_classes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitch_classes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">cycle</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">cycle</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pitch_classes</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>


<span class="c1"># ### 3D Embedding</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_012.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_012.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_dark&#39;</span><span class="p">,</span>
                            <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgba(0,0,0,1)&#39;</span><span class="p">,</span>
                            <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgba(0,0,0,1)&#39;</span><span class="p">,</span>
<span class="c1">#                             scene=dict(xaxis=dict(visible=False),</span>
<span class="c1">#                                        yaxis=dict(visible=False),</span>
<span class="c1">#                                        zaxis=dict(visible=False))</span>
                           <span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">cycle</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">y</span><span class="o">=</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">cycle</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">z</span><span class="o">=</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">cycle</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                           <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers+lines+text&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                           <span class="n">text</span><span class="o">=</span><span class="n">pitch_classes</span><span class="p">,</span>
                           <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;%</span><span class="si">{text}</span><span class="s2">&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
                          <span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># ### 4D Embedding</span>

<span class="c1"># Align higher-dimensional embeddings with lower-dimensional ones to get meaningful dimensions (lower dimensions will capture more relevant structures).</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">append_zeros</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">align_point_clouds</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">source</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Point clouds must have the same dimensions.&quot;</span>
    <span class="c1"># Compute centroids of each point cloud</span>
    <span class="n">source_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">target_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Center the point clouds</span>
    <span class="n">source_centered</span> <span class="o">=</span> <span class="n">source</span> <span class="o">-</span> <span class="n">source_center</span>
    <span class="n">target_centered</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">target_center</span>
    <span class="c1"># Compute covariance matrix</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">source_centered</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">target_centered</span><span class="p">)</span>
    <span class="c1"># Singular Value Decomposition (SVD)</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    <span class="c1"># Compute rotation matrix</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vt</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="c1"># Handle special case of reflection (when determinant is -1)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Vt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vt</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="c1"># Compute translation vector</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">target_center</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">source_center</span><span class="p">)</span>
    <span class="c1"># Apply transformation to source</span>
    <span class="n">aligned_source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">aligned_source</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span>

<span class="c1"># align and center</span>
<span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">append_zeros</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">e</span>
    <span class="n">aligned_source</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">align_point_clouds</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">embeddings</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">aligned_source</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">aligned_source</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># Plot the first two dimensions and the 3rd and 4th dimension separately. These plots suggest a circular structure. Get the angular components of the points for these two circles and plot the two phases against each other.</span>
<span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="what-geometric-shape-is-the-product-of-two-circles">
<h2>What geometric shape is the product of two circles?<a class="headerlink" href="#what-geometric-shape-is-the-product-of-two-circles" title="Link to this heading"></a></h2>
<p>%%
When looking at neighbouring pitch classes, what structure do you see in the phase plot?
—————————————————————————————-</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]),</span>
     <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cycle</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">])),</span>
<span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pitch_classes</span><span class="p">[</span><span class="n">cycle</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_013.png" srcset="../_images/sphx_glr_Practical_Shepard_Tones_and_Pitch-Class_Embeddings_013.png" alt="Practical Shepard Tones and Pitch Class Embeddings" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 30.401 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-practical-shepard-tones-and-pitch-class-embeddings-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/74a81632c525dd8c5c7236a054f52d6f/Practical_Shepard_Tones_and_Pitch-Class_Embeddings.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">Practical_Shepard_Tones_and_Pitch-Class_Embeddings.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/087daa52165d19324ad9b1bb22e106ca/Practical_Shepard_Tones_and_Pitch-Class_Embeddings.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">Practical_Shepard_Tones_and_Pitch-Class_Embeddings.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/32985fc586582e917fe25fb27b63b4d3/Practical_Shepard_Tones_and_Pitch-Class_Embeddings.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">Practical_Shepard_Tones_and_Pitch-Class_Embeddings.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Practical_Hierarchical_Models.html" class="btn btn-neutral float-left" title="Practical: Hierarchical Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Practical_Tonnetz_Generation.html" class="btn btn-neutral float-right" title="Tonnetz Generation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Robert Lieck, Eamonn Bell, Mark Gotham.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>